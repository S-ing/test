# AdaptiveCrossFusionæ¶æ„é…ç½® - åŸºäº1.yamlçš„ä¼˜åŒ–ç‰ˆ
# é’ˆå¯¹85% mAPé…ç½®çš„æ€§èƒ½ç“¶é¢ˆä¼˜åŒ–ï¼Œé¢„æœŸmAPæå‡è‡³88%+
# ä¸»è¦ä¼˜åŒ–ï¼šå……åˆ†è®­ç»ƒç­–ç•¥ + å¢å¼ºæ•°æ®å¢å¼º + ä¼˜åŒ–æ­£åˆ™åŒ–

BACKBONE2D:
  YOLOv8:
    ver : n

    PRETRAIN:
      n : weights/backbone2D/YOLOv8/v8_n.pth
      s : weights/backbone2D/YOLOv8/v8_s.pth
      m : weights/backbone2D/YOLOv8/v8_m.pth
      l : weights/backbone2D/YOLOv8/v8_l.pth
      x : weights/backbone2D/YOLOv8/v8_x.pth

BACKBONE3D:
  I3D:
    PRETRAIN:
      default: weights/backbone3D/I3D/rgb_imagenet.pth

# ğŸ”¬ å®éªŒ5æ ¸å¿ƒç»„åˆ: æœ€ä¼˜æŸå¤±æƒé‡ + Attentionèåˆ
LOSS:
  TAL:
    top_k  : 10
    alpha  : 0.7
    beta   : 6.0
    radius : 2.5
    soft_label : False  # ä¿æŒåŸºçº¿æœ€ä¼˜è®¾ç½®

    # ğŸ¯ é‡‡ç”¨exp2_loss_weights_v2çš„æœ€ä¼˜æŸå¤±æƒé‡é…ç½®
    scale_cls_loss : 1.5   # å¼ºåŒ–åˆ†ç±»æŸå¤± (v2æœ€ä¼˜)
    scale_box_loss : 5.0   # é€‚åº¦è¾¹æ¡†æŸå¤± (v2æœ€ä¼˜)
    scale_dfl_loss : 1.0   # è½»é‡DFLæŸå¤± (v2æœ€ä¼˜)

  SIMOTA:
    top_k: 10
    gamma: 0.5
    radius: 2.5
    mode: balance
    soft_label: False
    
    dynamic_k: False        # ä¿æŒåŠ¨æ€kç­–ç•¥
    dynamic_top_k: 40


    scale_cls_loss: 0.5
    scale_box_loss: 7.5
    scale_dfl_loss: 1.5

# è®­ç»ƒé…ç½® - AdaptiveCrossFusionä¼˜åŒ–ç‰ˆ
config_path       : config/exp11_adaptive_cross_fusion_config0925.yaml
dataset           : ucf
loss              : tal
active_checker    : True
num_classes       : 24
backbone2D        : yolov8
backbone3D        : i3d
fusion_module     : 'AdaptiveCross'  # ä½¿ç”¨AdaptiveCrossFusionæ¨¡å—
mode              : decoupled

# é€šé“é…ç½® - é€‚åº”YOLOv12n + AdaptiveCrossFusion
interchannels     : [64, 128, 256]  # åŒ¹é…YOLOv12nçš„backboneè¾“å‡º
pretrain_path     : weights/exp11_adaptive_cross_fusion0925/ema_epoch_7.pth
data_root         : /Xsb/YOWOv4/ucf24
img_size          : 224
clip_length       : 16

# è®­ç»ƒç­–ç•¥ - å……åˆ†è®­ç»ƒä¼˜åŒ–ç‰ˆ
batch_size        : 16           # å¢åŠ batch sizeï¼Œæé«˜è®­ç»ƒæ•ˆç‡å’Œæ¢¯åº¦ç¨³å®šæ€§
num_workers       : 8            # å¢åŠ æ•°æ®åŠ è½½çº¿ç¨‹
acc_grad          : 16           # ä¿æŒç´¯ç§¯æ¢¯åº¦æ­¥æ•°

# å­¦ä¹ ç‡ç­–ç•¥ - å……åˆ†è®­ç»ƒä¼˜åŒ–ç‰ˆ
lr                : 0.001        # æå‡å­¦ä¹ ç‡è‡³æ ‡å‡†æ°´å¹³ï¼ŒåŠ é€Ÿæ”¶æ•›
weight_decay      : 0.0005       # ä¿æŒé€‚ä¸­çš„æƒé‡è¡°å‡
max_step_warmup   : 1000         # å¢åŠ é¢„çƒ­æ­¥æ•°ï¼Œæé«˜è®­ç»ƒç¨³å®šæ€§
adjustlr_schedule : [1, 2, 3, 4, 5] # æ ‡å‡†å­¦ä¹ ç‡è¡°å‡ç­–ç•¥
max_epoch         : 7           # å¢åŠ è®­ç»ƒè½®æ•°ï¼Œå……åˆ†å­¦ä¹ 
lr_decay          : 0.5          # ä¿æŒé€‚ä¸­çš„å­¦ä¹ ç‡è¡°å‡
save_folder       : weights/exp11_adaptive_cross_fusion0925
sampling_rate     : 1
dropout           : 0.3          # å¢åŠ dropoutï¼Œæé«˜æ³›åŒ–èƒ½åŠ›

# æ¶æ„å¢å¼ºé…ç½® - ä¿æŒæˆåŠŸçš„æ³¨æ„åŠ›æœºåˆ¶
ENHANCEMENTS:
  # CSAMé€šé“æ³¨æ„åŠ›é…ç½® - ä¿æŒåŸæœ‰æˆåŠŸé…ç½®
  channel_attention:
    enabled: True
    reduction_ratio: 12      # ä¿æŒè¾ƒä½çš„é™ç»´æ¯”ä¾‹
    activation: 'swish'      # ä¿æŒé«˜æ•ˆçš„æ¿€æ´»å‡½æ•°
    scales: [1, 2, 4, 8]     # ä¿æŒ4ä¸ªå°ºåº¦å› å­
    fusion_type: 'weighted'   # èåˆæ–¹å¼ï¼šweighted, concat, add
  
  # SSAMç©ºé—´æ³¨æ„åŠ›é…ç½® - ä¿æŒåŸæœ‰æˆåŠŸé…ç½®
  spatial_attention:
    enabled: True
    kernel_size: 9           # ä¿æŒè¾ƒå¤§çš„å·ç§¯æ ¸
    activation: 'sigmoid'    # æ³¨æ„åŠ›æ¿€æ´»å‡½æ•°
    scales: [1, 2, 4, 8]     # ä¿æŒ4ä¸ªå°ºåº¦å› å­
  
  # è‡ªé€‚åº”èåˆæƒé‡é…ç½® - ä¿æŒåŸæœ‰æˆåŠŸé…ç½®
  adaptive_fusion:
    enabled: True
    learnable_weights: True  # å­¦ä¹ èåˆæƒé‡
    temperature: 0.8         # ä¿æŒè¾ƒä½çš„æ¸©åº¦å‚æ•°
    dropout_rate: 0.1        # é€‚åº¦å¢åŠ èåˆå±‚dropout
  
  # æ€§èƒ½ç›‘æ§é…ç½®
  performance_monitor:
    enabled: True
    log_flops: True          # è®°å½•FLOPs
    log_params: True         # è®°å½•å‚æ•°é‡
    log_memory: True         # è®°å½•å†…å­˜ä½¿ç”¨
    log_attention_weights: True  # è®°å½•æ³¨æ„åŠ›æƒé‡
    log_fusion_stats: True       # è®°å½•èåˆç»Ÿè®¡ä¿¡æ¯
    profile_frequency: 100       # æ€§èƒ½åˆ†æé¢‘ç‡

# æ•°æ®å¢å¼ºé…ç½® - å¢å¼ºæ³›åŒ–èƒ½åŠ›
DATA_AUGMENTATION:
  # ç©ºé—´å¢å¼º - é€‚ä¸­ç­–ç•¥ï¼ˆä»ä¿å®ˆæå‡åˆ°é€‚ä¸­ï¼‰
  spatial:
    random_crop: True
    random_flip: True
    random_rotation: 15      # å¢åŠ æ—‹è½¬è§’åº¦ï¼Œæå‡ç©ºé—´æ³›åŒ–
    color_jitter: 0.2        # å¢åŠ é¢œè‰²æŠ–åŠ¨ï¼Œæå‡å…‰ç…§é€‚åº”æ€§
  
  # æ—¶é—´å¢å¼º - é€‚ä¸­ç­–ç•¥ï¼ˆä»ä¿å®ˆæå‡åˆ°é€‚ä¸­ï¼‰
  temporal:
    random_temporal_crop: True
    temporal_stride: [1, 2]  # æ—¶é—´æ­¥é•¿å˜åŒ–
    frame_dropout: 0.1       # å¢åŠ å¸§ä¸¢å¼ƒæ¦‚ç‡ï¼Œæå‡æ—¶åºé²æ£’æ€§

# ä¼˜åŒ–å™¨é…ç½® - ä¿æŒæ ‡å‡†é…ç½®
OPTIMIZER:
  type: 'AdamW'              # ä¼˜åŒ–å™¨ç±»å‹
  betas: [0.9, 0.999]        # Adamå‚æ•°
  eps: 1e-8                  # æ•°å€¼ç¨³å®šæ€§å‚æ•°
  amsgrad: False             # æ˜¯å¦ä½¿ç”¨AMSGrad
  attention_lr_scale: 1.0    # æ³¨æ„åŠ›å±‚å­¦ä¹ ç‡ç¼©æ”¾

# å­¦ä¹ ç‡è°ƒåº¦å™¨é…ç½®
SCHEDULER:
  type: 'CosineAnnealingLR'  # ä½™å¼¦é€€ç«å­¦ä¹ ç‡
  T_max: 10                  # å‘¨æœŸé•¿åº¦
  eta_min: 1e-6              # æœ€å°å­¦ä¹ ç‡
  warmup_type: 'linear'      # é¢„çƒ­ç±»å‹
  warmup_attention: True     # æ³¨æ„åŠ›å±‚é¢„çƒ­

# UCF101-24æ•°æ®é›†ç±»åˆ«æ˜ å°„
idx2name:
  0  : Basketball
  1  : BasketballDunk
  2  : Biking
  3  : CliffDiving
  4  : CricketBowling
  5  : Diving
  6  : Fencing
  7  : FloorGymnastics
  8  : GolfSwing
  9  : HorseRiding
  10 : IceDancing
  11 : LongJump
  12 : PoleVault
  13 : RopeClimbing
  14 : SalsaSpin
  15 : SkateBoarding
  16 : Skiing
  17 : Skijet
  18 : SoccerJuggling
  19 : Surfing
  20 : TennisSwing
  21 : TrampolineJumping
  22 : VolleyballSpiking
  23 : WalkingWithDog

# ä¼˜åŒ–é…ç½®è¯´æ˜ï¼š
# 1. è®­ç»ƒå¼ºåº¦ä¼˜åŒ–ï¼šå­¦ä¹ ç‡æå‡è‡³0.001ï¼Œbatch_sizeå¢è‡³16ï¼Œè®­ç»ƒè½®æ•°å¢è‡³10
# 2. è®­ç»ƒç¨³å®šæ€§ä¼˜åŒ–ï¼šé¢„çƒ­æ­¥æ•°å¢è‡³1000ï¼Œä¿æŒæ ‡å‡†å­¦ä¹ ç‡è¡°å‡ç­–ç•¥
# 3. æ•°æ®å¢å¼ºå¢å¼ºï¼šæ—‹è½¬è§’åº¦å¢è‡³15Â°ï¼Œé¢œè‰²æŠ–åŠ¨å¢è‡³0.2ï¼Œå¸§ä¸¢å¼ƒå¢è‡³0.1
# 4. æ­£åˆ™åŒ–ä¼˜åŒ–ï¼šdropoutå¢è‡³0.3ï¼Œèåˆå±‚dropouté€‚åº¦å¢åŠ è‡³0.1
# 5. ä¿æŒæˆåŠŸå› ç´ ï¼šå¹³è¡¡çš„æŸå¤±æƒé‡ç­–ç•¥ï¼Œæœ‰æ•ˆçš„æ³¨æ„åŠ›æœºåˆ¶é…ç½®
# 6. å……åˆ†è®­ç»ƒä¿è¯ï¼šé€šè¿‡æå‡å­¦ä¹ ç‡å’Œå¢åŠ è®­ç»ƒè½®æ•°ç¡®ä¿å……åˆ†æ”¶æ•›
# 
# é¢„æœŸæ€§èƒ½ç›®æ ‡ï¼š
# - mAP: 88%+ (ä»85%æå‡è‡³88%+ï¼Œæå‡å¹…åº¦3.5%)
# - è®­ç»ƒç¨³å®šæ€§: é€šè¿‡å¢åŠ é¢„çƒ­æ­¥æ•°å’Œbatch_sizeæ˜¾è‘—æå‡
# - æ³›åŒ–èƒ½åŠ›: é€šè¿‡å¢å¼ºæ•°æ®å¢å¼ºå’Œé€‚åº¦æ­£åˆ™åŒ–å¤§å¹…æå‡
# - æ”¶æ•›æ•ˆæœ: é€šè¿‡æå‡å­¦ä¹ ç‡å’Œå……åˆ†è®­ç»ƒè½®æ•°ç¡®ä¿æœ€ä¼˜æ”¶æ•›
# - ç‰¹å¾èåˆè´¨é‡: ä¿æŒåŸæœ‰æˆåŠŸçš„æ³¨æ„åŠ›æœºåˆ¶é…ç½®
# - æ•´ä½“å¹³è¡¡æ€§: åœ¨ä¿æŒæˆåŠŸå› ç´ åŸºç¡€ä¸Šé’ˆå¯¹æ€§ä¼˜åŒ–ç“¶é¢ˆ

#  epoch10  map 87.34   epoch 7 87.73